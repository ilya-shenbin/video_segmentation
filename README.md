Реализация алгоритма суперпиксельной сегментации изображений
Simple Iterative Linear Clustering с последующим объединением сегментов.

## Описание алгоритмов

#### Simple Iterative Linear Clustering

Алгоритм SILC является модификацией k-means со следующими изменениями: центры
кластеров инициализируются не случайным образом, а по равномерной сетке с шагом S;
расстояния от центров кластеров вычисляются не для всех точех, а только для тех,
которые принадлежат квадратной окрестности центра со стороной 2S.

В качестве вектора признаков пиксела предлагается взять его цвет в пространстве CIELAB,
а так же его координаты. Расстояния между векторами признаков вычисляются евклидовой
метрикой. Так как цвета и координаты - значения разной природы, предлагается при
вычислении метрики домножать значения координат на некоторую задаваемую пользователем
константу (0.1 по умолчанию).

#### Объединение кластеров

При использовании методов суперпиксельной сегментации некоторые однородные области
оказываются разделёнными на несколько сегментов. Поэтому предлагается объединять
похожие области, находящиеся друг от друга на небольшом расстоянии.

Для этого представим сегментированное изображение в виде графа, где вершинами будут
сегменты, а вес рёбер между ними - схожесть их признаковых описаний. Признаками в
данном случае будут усреднённые цвета кластеров, а так же координаты их центров.
Схожесть будем вычислять как сумму евклидова расстояния между цветами и манхэттенского
расстояния между координатами (так как, с одной стороны, они не сильно важны,
с другой - предполагается, что один и тот же сегмент не может быть сильно разбросанным
по изображению).

Теперь построим минимальное остовное дерево графа, удалим рёбра с большим весом
(порог устанавливается вручную), полученные компоненты связности будут соответствовать
новым сегментам.

## Результаты работы

_DemoImage.java_

Шаг сетки: 50, порог объединения кластеров: 100:

![](http://imageshack.com/a/img923/125/sTsaTk.png)

Шаг сетки: 100, без объединения кластеров:

![](http://imageshack.com/a/img922/9522/gfM2wN.png)

_DemoVideo.java_ (первый кадр)

Шаг сетки: 50, порог объединения кластеров: 50:

![](http://imageshack.com/a/img922/8826/9s1oQ2.png)

Шаг сетки: 100, без объединения кластеров:

![](http://imageshack.com/a/img921/1091/WrZi0K.png)

Видео, сосотящее из 40 кадров с разрешением 768x576, было обработано за 29 секунд
(i7 3610QM 2300 Mhz).

## Структура

* SimpleIterativeLinearClustering - реализация SILC. Параметры:

  * _segStep_ - расстояние между соседними кластерами при инициализации;

  * _maxIter_ - число итераций k-means;

  * _posWeight_ - коэффициент перед значениями координат при вычислении расстояний;

  * _mergingTolerance_ - пороговое значение для расстояний между признаковыми
  описаниями сегментов

* SegmentationVisualization - визуализация сегментации изображения, разделение
линиями границ сегментов


* MSTClusterMerging - алгоритм объединения кластеров, часть метода SILC, все методы
package private

* RGB2Lab - преобразование цветового пространства RGB в CIE 1976 L\*a\*b\*

* VideoReader - чтение видео из файла, преобразование фреймов в BufferedImage

## Используемые библиотеки

* ImageJ - чтение/запись изображений

* Xuggle - чтение видеопотока

* JUnit - тестирование

* JGraphT - работа с графами (нахождение минимального остовного дерева и компонент связности для алгоритма объединения кластеров)

## Запуск демо

Main-класс - DemoVideo

Запуск jar-файла, скомпилированного при помощи maven
```
java -jar target\ru.spbu.videosegmentation-1.0-SNAPSHOT-jar-with-dependencies.jar [input_filename] [output_directory] [segStep] [maxIter] [posWeight] [mergingTolerance]
```
* input_filename - название видеофайла
* output_directory - существующая директория для сегментированных кадров из видео
* Остальные аргументы совпадают с аргументами конструктора
SimpleIterativeLinearClustering (описано выше)

Пример параметров
```
data/demo2.mp4 data/res 20 1 0.1 25
```